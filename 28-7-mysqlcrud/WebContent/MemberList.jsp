<!-- 2018-07-11 이광재 -->
<%@ page language="java" contentType="text/html; charset=EUC-KR" pageEncoding="EUC-KR"%>
<%@ page import = "service.MemberDao"%>
<%@ page import = "service.Member" %>
<%@ page import = "java.util.ArrayList"%>
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
		<title>memberList</title>
		<style>
			#customers {
			    font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
			    border-collapse: collapse;
			    width: 500px;
			}
			
			#customers td, #customers th {
			    border: 1px solid #ddd;
			    padding: 8px;
			}
			
			#customers tr:nth-child(even){background-color: #f2f2f2;}
			
			#customers tr:hover {background-color: #ddd;}
			
			#customers th {
			    padding-top: 12px;
			    padding-bottom: 12px;
			    text-align: left;
			    background-color: #4CAF50;
			    color: white;
			}
		</style>
	</head>
	<body>
		<h3>MemberList</h3>
		<table id="customers">
			<tr>
				<th>no</th>
				<th>name</th>
				<th>age</th>
				<th>주소입력</th>
				<th>점수입력</th>
				<th>점수확인</th>
				<th>삭제</th>
				<th>수정</th>
			</tr>
		<%	
			request.setCharacterEncoding("euc-kr");
			int currentPage = 1;
			if(request.getParameter("currentPage") != null) { //다음을 클릭 했을때 참조값을 넘기지 않으면 null로 처리한다.
				currentPage = Integer.parseInt(request.getParameter("currentPage")); // String 타입으로 넘어온 "currentPage" 변수의 타입을 int로 변환하여 저장한다.
			}    
 
			int pagePerRow = 5;
			
			String searchWord = request.getParameter("searchWord");
			System.out.println(searchWord + " : 01 searchWord check");
			
			MemberDao memberDao = new MemberDao();
			ArrayList<Member> list = memberDao.selectMemberByPage(currentPage, pagePerRow);
			System.out.println(list + " : 02 list check");
			
			ArrayList<Member> searchList = memberDao.searchMemberList(currentPage, pagePerRow, searchWord);
			System.out.println(searchList + " : 03 searchList check");
			
			int RowNumber = list.get(0).getRowNumber();
			if(searchList.size() > 0) {
				RowNumber = searchList.get(0).getRowNumber();
			}
			
			if (searchList.size() == 0) {
				for(int i=0; i<list.size(); i++) {
		%>
					<tr>
						<td><%=list.get(i).getMemberNo()%></td>
						<td><a href="./MemberAddrList.jsp?no=<%=list.get(i).getMemberNo()%>"><%=list.get(i).getMemberName()%></a></td>
						<td><%=list.get(i).getMemberAge()%></td>
						<td><a href="./InsertMemberAddrForm.jsp?no=<%=list.get(i).getMemberNo()%>">주소입력</a></td>
						<td><a href="./InsertMemberScoreForm.jsp?no=<%=list.get(i).getMemberNo()%>">점수입력</a></td>
						<td><a href="./MemberAndPersonalScore.jsp?no=<%=list.get(i).getMemberNo()%>">점수확인</a></td>
						<td><a href="./DeleteMemberAction.jsp?no=<%=list.get(i).getMemberNo()%>">삭제</a></td>
						<td><a href="./UpdateMemberForm.jsp?no=<%=list.get(i).getMemberNo()%>">수정</a></td>
					</tr>
		<%
				}
			} else if (searchList.size() > 0) {
				for (int i=0; i<searchList.size(); i++) {
		%>
				<tr>
					<td><%=searchList.get(i).getMemberNo()%></td>
					<td><a href="./MemberAddrList.jsp?no=<%=searchList.get(i).getMemberNo()%>"><%=searchList.get(i).getMemberName()%></a></td>
					<td><%=searchList.get(i).getMemberAge()%></td>
					<td><a href="./InsertMemberAddrForm.jsp?no=<%=searchList.get(i).getMemberNo()%>">주소입력</a></td>
					<td><a href="./InsertMemberScoreForm.jsp?no=<%=searchList.get(i).getMemberNo()%>">점수입력</a></td>
					<td><a href="./MemberAndPersonalScore.jsp?no=<%=searchList.get(i).getMemberNo()%>">점수확인</a></td>
					<td><a href="./DeleteMemberAction.jsp?no=<%=searchList.get(i).getMemberNo()%>">삭제</a></td>
					<td><a href="./UpdateMemberForm.jsp?no=<%=searchList.get(i).getMemberNo()%>">수정</a></td>
				</tr>
		<%
				}
			}
		%>
		</table>
		<form action="./MemberList.jsp" method="post">
			<div>
				이름 :
				<input type="text" name="searchWord">
				<button type="submit">회원검색</button>
			</div>
		</form>
		<%
			if(currentPage>1) { //currentPage 값이 1보다 클때만 실행
				if(searchList.size() == 0) {
		%>
					<a href="./MemberList.jsp?currentPage=<%=currentPage-1%>">이전</a> <!-- 이전 페이지 버튼 클릭시 "currentPage"변수로 currentPage-1의 값을 전송 --> 
		<%
				} else if (searchList.size() > 0) {
		%>
					<a href="./MemberList.jsp?currentPage=<%=currentPage-1%>&searchWord=<%=searchList.get(0).getSearchWord()%>">이전</a> <!-- 이전 페이지 버튼 클릭시 "currentPage"변수로 currentPage-1의 값을 전송 -->
		<%
				}
			}
			int lastPage = ((RowNumber-1) / pagePerRow) +1 ; // rowNumber-1의 값과 페이지당 행의 수와의 몫이 마지막 페이지의 넘버.
			
			
			for(int i=1; i<lastPage; i++) {
		%>
				<a href="./MemberList.jsp?currentPage=<%=i%>">[<%=i%>]</a>
		<%
			}
			
			if(currentPage<lastPage) { //현재 페이지 넘버가 마지막 페이지 넘버보다 작아졌을때만 실행.
				if(searchList.size() == 0) {
		%>
					<a href="./MemberList.jsp?currentPage=<%=currentPage+1%>">다음</a> <!-- 다음 페이지 버튼 클릭시 "currentPage"변수로 currentPage+1의 값을 전송 -->
		<%
				} else if (searchList.size() > 0) {
		%>
					<a href="./MemberList.jsp?currentPage=<%=currentPage+1%>&searchWord=<%=searchList.get(0).getSearchWord()%>">다음</a> <!-- 다음 페이지 버튼 클릭시 "currentPage"변수로 currentPage+1의 값을 전송 -->
		<%
				}
			}
		%>
		<br><br>
		<div>
		<a href = "./index.jsp">메인화면으로..</a>
		</div>
		<div>
		<a href="./InsertMemberForm.jsp">회원가입</a>
		</div>
	</body>
</html>